<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSC Advogados - Painel Interativo de Cobrança</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@700;900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa; 
        }
        h1, h2, h3, .kpi-title { font-family: 'Merriweather', serif; }
        :root {
            --cor-verde-bsc: #00332c;
            --cor-dourado-bsc: #c3a177;
            --cor-cinza-bsc: #f0f0f0;
        }
        
        /* Estilo dos Botões de Filtro */
        .filter-button {
            transition: all 0.2s ease;
            border: 2px solid var(--cor-verde-bsc);
            color: var(--cor-verde-bsc);
            padding: 6px 14px;
            border-radius: 99px; /* Pílula */
            font-weight: 600;
        }
        .filter-button:hover {
            background-color: var(--cor-cinza-bsc);
        }
        .filter-button.active {
            background-color: var(--cor-verde-bsc);
            color: white;
        }

        /* Container dos Gráficos */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 300px; 
            margin-left: auto;
            margin-right: auto;
        }

        /* Estilos da tabela */
        .cobranca-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.85rem;
        }
        .cobranca-table th, .cobranca-table td {
            border: 1px solid #ddd;
            padding: 10px 12px;
            text-align: left;
            white-space: nowrap; 
        }
        .cobranca-table th {
            background-color: var(--cor-verde-bsc);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .cobranca-table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .table-container {
            width: 100%;
            overflow-x: auto; 
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="bg-zinc-50 text-gray-800 antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 pb-6 border-b-2" style="border-color: var(--cor-dourado-bsc);">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold" style="color: var(--cor-verde-bsc);">
                    Painel Interativo de Cobrança
                </h1>
                <p class="text-xl text-gray-600">BSC Advogados e Associados</p>
            </div>
            <img src="BSC-1.jpg" alt="Logo BSC Advogados" class="w-48 h-auto mt-4 md:mt-0">
        </header>
        
        <!-- KPIs (Indicadores) -->
        <section id="kpi-section" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-8">
            <div class="bg-white p-5 rounded-xl shadow-lg text-center">
                <h3 class="kpi-title text-lg font-semibold text-gray-600 mb-1">Valor Total Atualizado</h3>
                <p class="text-3xl font-bold" style="color: var(--cor-verde-bsc);" id="kpi-valor-total">R$ 0,00</p>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-lg text-center">
                <h3 class="kpi-title text-lg font-semibold text-gray-600 mb-1">Total de Devedores</h3>
                <p class="text-3xl font-bold" style="color: var(--cor-verde-bsc);" id="kpi-total-casos">0</p>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-lg text-center">
                <h3 class="kpi-title text-lg font-semibold text-gray-600 mb-1">Casos Ajuizados</h3>
                <p class="text-3xl font-bold" style="color: var(--cor-verde-bsc);" id="kpi-ajuizados">0</p>
            </div>
             <div class="bg-white p-5 rounded-xl shadow-lg text-center">
                <h3 class="kpi-title text-lg font-semibold text-gray-600 mb-1">Taxa de Ajuizamento</h3>
                <p class="text-3xl font-bold" style="color: var(--cor-verde-bsc);" id="kpi-taxa-ajuizamento">0%</p>
            </div>
        </section>
        
        <!-- Filtros Interativos -->
        <section id="filter-section" class="bg-white p-4 rounded-xl shadow-lg mb-8">
            <div class="flex flex-wrap items-center gap-x-6 gap-y-4">
                <h3 class="text-lg font-bold" style="color: var(--cor-verde-bsc);">FILTRAR POR:</h3>
                
                <!-- Filtro Ajuizado -->
                <div class="flex items-center gap-2" data-filter-group="ajuizado">
                    <span class="font-semibold text-gray-700">Ajuizado:</span>
                    <button class="filter-button active" data-filter-value="todos">Todos</button>
                    <button class="filter-button" data-filter-value="Sim">Sim</button>
                    <button class="filter-button" data-filter-value="Não">Não</button>
                </div>
                
                <!-- Filtro Cobrança -->
                <div class="flex items-center gap-2" data-filter-group="cobranca">
                    <span class="font-semibold text-gray-700">Cobrança:</span>
                    <button class="filter-button active" data-filter-value="todos">Todos</button>
                    <button class="filter-button" data-filter-value="Sim">Sim</button>
                    <button class="filter-button" data-filter-value="Não">Não</button>
                </div>
            </div>
        </section>

        <main>
            <!-- Gráficos -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-semibold text-center mb-4" style="color: var(--cor-verde-bsc);">Tipos de Ação</h2>
                    <div class="chart-container">
                        <canvas id="acaoChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-semibold text-center mb-4" style="color: var(--cor-verde-bsc);">Status de Protesto</h2>
                    <div class="chart-container">
                        <canvas id="protestoChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tabela Detalhada -->
            <div class="mt-12">
                <h2 class="text-3xl font-bold mb-4" style="color: var(--cor-verde-bsc);">Tabela Detalhada</h2>
                <div class="table-container bg-white">
                    <div id="tabela-placeholder">
                        <p class="text-center p-10 text-gray-500">Carregando dados...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Carrega o Chart.js no final do body -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // --- [ DADOS DA PLANILHA EMBUTIDOS AQUI ] ---
        // Isto elimina a necessidade de um .json separado e corrige
        // todos os problemas de cache e 'file://'.
        const dadosDaPlanilha = [
          {
            "Cobrança": "Sim",
            "Devedor": "Gilvan Domingues",
            "Título": "Promissória",
            "Vencimento": "2024-06-29",
            "Prescrição/Ex.": "2028-06-16",
            "Ação": "Execução",
            "Vlr. Original": "R$ 53.000,00",
            "Vlr. Débito": "R$ 49.000,00",
            "Vlr. Atualizado": "R$ 59.417,08",
            "Protesto": "Sim",
            "Dt. Protesto": "2025-06-16",
            "Ajuizado": "Sim",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Não",
            "Devedor": "Eliene Silva",
            "Título": "Contrato",
            "Vencimento": "2021-07-20",
            "Prescrição/Ex.": "N/A",
            "Ação": "Execução",
            "Vlr. Original": "R$ 12.000,00",
            "Vlr. Débito": "R$ 60.720,00",
            "Vlr. Atualizado": "R$ 60.720,00",
            "Protesto": "Sim",
            "Dt. Protesto": "N/A",
            "Ajuizado": "Não",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Sim",
            "Devedor": "JBJ Casa Carnes",
            "Título": "Cheques",
            "Vencimento": "2025-02-03",
            "Prescrição/Ex.": "2025-08-03",
            "Ação": "Locupletamento",
            "Vlr. Original": "R$ 35.280,00",
            "Vlr. Débito": "R$ 35.280,00",
            "Vlr. Atualizado": "R$ 39.276,69",
            "Protesto": "Não",
            "Dt. Protesto": "N/A",
            "Ajuizado": "Não",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Sim",
            "Devedor": "Leidiane Nere",
            "Título": "Cheques",
            "Vencimento": "2022-07-14",
            "Prescrição/Ex.": "2023-01-14",
            "Ação": "Cobrança",
            "Vlr. Original": "R$ 5.129,00",
            "Vlr. Débito": "R$ 5.129,00",
            "Vlr. Atualizado": "R$ 8.009,08",
            "Protesto": "Não",
            "Dt. Protesto": "N/A",
            "Ajuizado": "Sim",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Não",
            "Devedor": "Jorge Bonfim",
            "Título": "Promissória",
            "Vencimento": "2023-04-16",
            "Prescrição/Ex.": "2026-04-24",
            "Ação": "Cobrança",
            "Vlr. Original": "R$ 5.596,00",
            "Vlr. Débito": "R$ 5.596,00",
            "Vlr. Atualizado": "R$ 7.997,33",
            "Protesto": "Sim",
            "Dt. Protesto": "2023-04-27",
            "Ajuizado": "Não",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Não",
            "Devedor": "João Benavides",
            "Título": "Cheques",
            "Vencimento": "2023-08-22",
            "Prescrição/Ex.": "3026-10-30",
            "Ação": "Locupletamento",
            "Vlr. Original": "R$ 1.650,00",
            "Vlr. Débito": "R$ 1.650,00",
            "Vlr. Atualizado": "R$ 2.269,59",
            "Protesto": "Sim",
            "Dt. Protesto": "2023-10-30",
            "Ajuizado": "Sim",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Sim",
            "Devedor": "Edjane Melo",
            "Título": "Cheques",
            "Vencimento": "2023-10-13",
            "Prescrição/Ex.": "2027-10-04",
            "Ação": "Locupletamento",
            "Vlr. Original": "R$ 11.000,00",
            "Vlr. Débito": "R$ 11.000,00",
            "Vlr. Atualizado": "R$ 14.319,90",
            "Protesto": "Sim",
            "Dt. Protesto": "2024-10-04",
            "Ajuizado": "Sim",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Sim",
            "Devedor": "Deborah Priscila",
            "Título": "Cheques",
            "Vencimento": "2023-06-21",
            "Prescrição/Ex.": "3026-10-30",
            "Ação": "Cobrança",
            "Vlr. Original": "R$ 1.650,00",
            "Vlr. Débito": "R$ 1.650,00",
            "Vlr. Atualizado": "R$ 2.301,24",
            "Protesto": "Sim",
            "Dt. Protesto": "2023-10-30",
            "Ajuizado": "Não",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Não",
            "Devedor": "Antonio Mendes",
            "Título": "Cheques",
            "Vencimento": "2024-02-20",
            "Prescrição/Ex.": "2027-03-08",
            "Ação": "Locupletamento",
            "Vlr. Original": "R$ 3.000,00",
            "Vlr. Débito": "R$ 3.000,00",
            "Vlr. Atualizado": "R$ 3.865,85",
            "Protesto": "Sim",
            "Dt. Protesto": "2024-03-08",
            "Ajuizado": "Sim",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Sim",
            "Devedor": "Wilson Araujo",
            "Título": "Promissória",
            "Vencimento": "2020-12-16",
            "Prescrição/Ex.": "2024-07-21",
            "Ação": "Cobrança",
            "Vlr. Original": "R$ 11.000,00",
            "Vlr. Débito": "R$ 11.000,00",
            "Vlr. Atualizado": "R$ 23.047,13",
            "Protesto": "Sim",
            "Dt. Protesto": "2021-07-21",
            "Ajuizado": "Sim",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Sim",
            "Devedor": "Erenilton/Wilson A.",
            "Título": "Promissória",
            "Vencimento": "2021-01-30",
            "Prescrição/Ex.": "2024-07-21",
            "Ação": "Cobrança",
            "Vlr. Original": "R$ 3.600,00",
            "Vlr. Débito": "R$ 3.600,00",
            "Vlr. Atualizado": "R$ 7.340,05",
            "Protesto": "Sim",
            "Dt. Protesto": "2021-07-21",
            "Ajuizado": "Sim",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Não",
            "Devedor": "L L Araujo",
            "Título": "Cheques",
            "Vencimento": "2021-03-16",
            "Prescrição/Ex.": "2024-07-21",
            "Ação": "Cobrança",
            "Vlr. Original": "R$ 8.000,00",
            "Vlr. Débito": "R$ 8.000,00",
            "Vlr. Atualizado": "R$ 16.031,57",
            "Protesto": "Sim",
            "Dt. Protesto": "2021-07-21",
            "Ajuizado": "Não",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          },
          {
            "Cobrança": "Não",
            "Devedor": "Alceu Rodrigues",
            "Título": "Confissão",
            "Vencimento": "2021-04-15",
            "Prescrição/Ex.": "N/A",
            "Ação": "Execução",
            "Vlr. Original": "R$ 17.227,00",
            "Vlr. Débito": "R$ 18.949,70",
            "Vlr. Atualizado": "R$ 35.488,53",
            "Protesto": "Sim",
            "Dt. Protesto": "N/A",
            "Ajuizado": "Não",
            "Nº Processo": "N/A",
            "Vara": "N/A",
            "Comarca": "N/A"
          }
        ];
        // --- [ FIM DOS DADOS EMBUTIDOS ] ---

        let allData = []; // Para guardar os dados processados
        let chartInstances = {}; // Para guardar os objetos dos gráficos
        let currentFilters = { ajuizado: 'todos', cobranca: 'todos' }; // Estado dos filtros

        const bscPalette = ['#00332c', '#c3a177', '#5a8f7b', '#333333', '#8f8f8f'];

        // Funções de ajuda (Helpers)
        function parseCurrency(text) {
            if (!text) return 0;
            let num = String(text).replace('R$ ', '').replace(/\./g, '').replace(',', '.');
            return parseFloat(num) || 0;
        }

        function formatCurrency(num) {
            return num.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        
        // Função principal que roda tudo
        function runDashboard() {
            try {
                // 1. Processa os dados da variável interna
                allData = dadosDaPlanilha.map(item => ({
                    ...item,
                    _valorAtualizadoNum: parseCurrency(item['Vlr. Atualizado'])
                }));
                
                // 2. Configura os botões de filtro
                setupFilters();
                
                // 3. Renderiza o dashboard inicial
                renderDashboard();
                
            } catch (error) {
                console.error("Erro ao inicializar o dashboard:", error);
                document.body.innerHTML = `<p class="text-center p-10 text-red-600"><b>Erro fatal:</b> ${error.message}. Verifique o console.</p>`;
            }
        }

        // Configura os cliques dos botões de filtro
        function setupFilters() {
            const filterGroups = document.querySelectorAll('[data-filter-group]');
            filterGroups.forEach(group => {
                const groupName = group.dataset.filterGroup;
                const buttons = group.querySelectorAll('.filter-button');
                
                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Atualiza o estado do filtro
                        currentFilters[groupName] = button.dataset.filterValue;
                        
                        // Atualiza a aparência dos botões
                        buttons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        
                        // Re-renderiza o dashboard com os novos filtros
                        renderDashboard();
                    });
                });
            });
        }

        // Função que aplica filtros e re-renderiza tudo
        function renderDashboard() {
            if (allData.length === 0) return;

            // 1. Aplicar filtros
            const filteredData = allData.filter(item => {
                const matchAjuizado = (currentFilters.ajuizado === 'todos') || (item.Ajuizado === currentFilters.ajuizado);
                const matchCobranca = (currentFilters.cobranca === 'todos') || (item.Cobrança === currentFilters.cobranca);
                return matchAjuizado && matchCobranca;
            });

            // 2. Atualizar KPIs com dados filtrados
            updateKPIs(filteredData);
            
            // 3. Atualizar Gráficos com dados filtrados
            renderCharts(filteredData);
            
            // 4. Atualizar Tabela com dados filtrados
            renderTabela(filteredData);
        }

        // Atualiza os KPIs
        function updateKPIs(data) {
            const totalAtualizado = data.reduce((sum, item) => sum + item._valorAtualizadoNum, 0);
            const totalCasos = data.length;
            const totalAjuizado = data.filter(d => d.Ajuizado === 'Sim').length;
            const taxaAjuizamento = (totalCasos > 0) ? (totalAjuizado / totalCasos) * 100 : 0;

            document.getElementById('kpi-valor-total').textContent = formatCurrency(totalAtualizado);
            document.getElementById('kpi-total-casos').textContent = totalCasos;
            document.getElementById('kpi-ajuizados').textContent = totalAjuizado;
            document.getElementById('kpi-taxa-ajuizamento').textContent = `${taxaAjuizamento.toFixed(0)}%`;
        }

        // Desenha/Atualiza os gráficos
        function renderCharts(data) {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js não foi carregado.');
                return;
            }

            // Dados do Gráfico de Ação
            const acaoCounts = {};
            data.forEach(item => {
                const acao = item.Ação || 'N/A';
                acaoCounts[acao] = (acaoCounts[acao] || 0) + 1;
            });
            renderChart('acaoChart', 'doughnut', Object.keys(acaoCounts), Object.values(acaoCounts));

            // Dados do Gráfico de Protesto
            const protestoCounts = {};
            data.forEach(item => {
                const protesto = item.Protesto || 'N/A';
                protestoCounts[protesto] = (protestoCounts[protesto] || 0) + 1;
            });
            renderChart('protestoChart', 'doughnut', Object.keys(protestoCounts), Object.values(protestoCounts));
        }

        // Função genérica para criar/atualizar um gráfico
        function renderChart(canvasId, type, labels, data) {
            if (chartInstances[canvasId]) {
                chartInstances[canvasId].destroy();
            }
            const ctx = document.getElementById(canvasId).getContext('2d');
            chartInstances[canvasId] = new Chart(ctx, {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total de Casos',
                        data: data,
                        backgroundColor: bscPalette,
                        borderWidth: 1,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
        }

        // Desenha/Atualiza a tabela detalhada
        function renderTabela(data) {
            const container = document.getElementById('tabela-placeholder');
            if (data.length === 0) {
                container.innerHTML = '<p class="text-center p-10 text-gray-500">Nenhum dado encontrado para estes filtros.</p>';
                return;
            }

            const headers = Object.keys(data[0]).filter(h => !h.startsWith('_'));
            let tableHtml = '<table class="cobranca-table">';
            
            tableHtml += '<thead><tr>';
            headers.forEach(header => tableHtml += `<th>${header}</th>`);
            tableHtml += '</tr></thead>';

            tableHtml += '<tbody>';
            data.forEach(item => {
                const cobrancaClass = item['Cobrança'] === 'Sim' ? 'text-green-700 font-semibold' : 'text-red-700';
                const ajuizadoClass = item['Ajuizado'] === 'Sim' ? 'text-green-700 font-semibold' : 'text-red-700';
                tableHtml += '<tr>';
                headers.forEach(header => {
                    let value = item[header] || 'N/A';
                    if (header === 'Cobrança') {
                        tableHtml += `<td class="${cobrancaClass}">${value}</td>`;
                    } else if (header === 'Ajuizado') {
                        tableHtml += `<td class="${ajuizadoClass}">${value}</td>`;
                    } else if (header.startsWith('Vlr.')) {
                        tableHtml += `<td class="font-medium text-gray-900">${value}</td>`;
                    } else {
                        tableHtml += `<td>${value}</td>`;
                    }
                });
                tableHtml += '</tr>';
            });
            tableHtml += '</tbody></table>';

            container.innerHTML = tableHtml;
        }

        // Espera a página inteira carregar (incluindo o script do Chart.js)
        // antes de tentar executar qualquer código.
        window.onload = function() {
            runDashboard();
        };
    </script>

</body>
</html>
